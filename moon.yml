$schema: 'https://moonrepo.dev/schemas/project.json'

stack: 'unknown'

language: gleam

fileGroups:
  sources:
    - 'src/**/*.gleam'
    - 'test/**/*.gleam'
  configs:
    - 'gleam.toml'
    - 'moon.yml'

tasks:
  build:
    command: 'gleam build'
    outputs:
      - 'build/dev/erlang/**/*'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  test:
    command: 'gleam test'
    deps:
      - 'build'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  run:
    command: 'gleam run'
    args:
      - '--module'
      - factory

  clean:
    command: 'gleam clean'

  format:
    command: 'gleam format'
    args:
      - '--check'
      - 'src'
      - 'test'

  format-fix:
    command: 'gleam format'
    args:
      - 'src'
      - 'test'

  lint:
    command: 'gleam check'
    deps:
      - 'build'
    inputs:
      - '@group(sources)'

  update:
    command: 'gleam update'

  ci:
    command: 'bash -c ''moon run format && moon run build && moon run test && moon run lint'''
